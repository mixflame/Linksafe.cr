require "uri"

# TODO: Write documentation for `Linksafe`
module Linksafe
  VERSION = "0.1.0"

  SAFE_DOMAINS = "apple.com
www.google.com
youtube.com
www.blogger.com
docs.google.com
microsoft.com
support.google.com
play.google.com
adobe.com
maps.google.com
en.wikipedia.org
cloudflare.com
linkedin.com
wordpress.org
plus.google.com
accounts.google.com
vimeo.com
europa.eu
googleusercontent.com
drive.google.com
mozilla.org
sites.google.com
youtu.be
medium.com
bbc.co.uk
facebook.com
bp.blogspot.com
amazon.com
line.me
github.com
es.wikipedia.org
vk.com
creativecommons.org
istockphoto.com
theguardian.com
whatsapp.com
google.fr
policies.google.com
forbes.com
nytimes.com
developers.google.com
wikimedia.org
feedburner.com
photos.google.com
aliexpress.com
dropbox.com
gstatic.com
t.me
get.google.com
who.int
paypal.com
uol.com.br
fr.wikipedia.org
bbc.com
www.yahoo.com
msn.com
cnn.com
pt.wikipedia.org
google.es
w3.org
mail.google.com
dailymotion.com
jimdofree.com
google.de
imdb.com
nih.gov
buydomains.com
hugedomains.com
mail.ru
globo.com
reuters.com
google.co.uk
live.com
news.google.com
myspace.com
google.co.jp
google.com.br
slideshare.net
issuu.com
ig.com.br
businessinsider.com
translate.google.com
thesun.co.uk
office.com
wikia.com
webmd.com
cpanel.com
amazon.co.uk
hatena.ne.jp
telegraph.co.uk
ft.com
lefigaro.fr
pinterest.com
picasa.google.com
themeforest.net
foxnews.com
networkadvertising.org
www.wix.com
usatoday.com
scribd.com
archive.org
de.wikipedia.org
washingtonpost.com
myaccount.google.com
google.ru
wired.com
fb.com
tinyurl.com
independent.co.uk
aol.com
terra.com.br
files.wordpress.com
dan.com
www.gov.uk
dailymail.co.uk
mediafire.com
picasaweb.google.com
abcnews.go.com
ipv4.google.com
change.org
namecheap.com
search.google.com
amazon.de
plesk.com
cdc.gov
code.google.com
ok.ru
android.com
bloomberg.com
mirror.co.uk
time.com
bing.com
aboutads.info
marketingplatform.google.com
privacyshield.gov
youronlinechoices.com
twitter.com
books.google.com
google.it
gravatar.com
nasa.gov
telegram.me
fandom.com
wsj.com
abril.com.br
samsung.com
amazon.co.jp
elpais.com
draft.blogger.com
cnet.com
rakuten.co.jp
id.wikipedia.org
tools.google.com
goo.gl
steampowered.com
sedo.com
bit.ly
news.yahoo.com
rt.com
un.org
ebay.com
huffingtonpost.com
booking.com
opera.com
harvard.edu
cpanel.net
yahoo.co.jp
ovh.com
britannica.com
groups.google.com
nokia.com
buzzfeed.com
nhk.or.jp
techcrunch.com
secureserver.net
hp.com
npr.org
instructables.com
kickstarter.com
playstation.com
ietf.org
columbia.edu
finance.yahoo.com
latimes.com
google.nl
amazon.es
oup.com
ted.com
my.yahoo.com
enable-javascript.com
stackoverflow.com
loc.gov
netvibes.com
lemonde.fr
bloglovin.com
list-manage.com
google.com.tw
economist.com
wp.com
ovh.net
imageshack.us
newsweek.com
umich.edu
ibm.com
depositfiles.com
m.wikipedia.org
bandcamp.com
walmart.com
ign.com
rapidshare.com
abc.net.au
elmundo.es
ggpht.com
over-blog-kiwi.com
pixabay.com
yandex.ru
researchgate.net
instagram.com
hm.com
dw.com
hollywoodreporter.com
pexels.com
addtoany.com
biglobe.ne.jp
addthis.com
trustpilot.com
goo.ne.jp
forms.gle
quora.com
nginx.org
gizmodo.com
yale.edu
weibo.com
nypost.com
scoop.it
shutterstock.com
news.com.au
mozilla.com
noaa.gov
disqus.com
php.net
bp2.blogger.com
000webhost.com
guardian.co.uk
google.co.in
lg.com
windowsphone.com
storage.googleapis.com
ria.ru
netflix.com
gnu.org
unesco.org
cbsnews.com
orkut.com.br
abc.es
imageshack.com
sapo.pt
ytimg.com
vice.com
usnews.com
psychologytoday.com
www.livejournal.com
mega.nz
alibaba.com
ovh.co.uk
yelp.com
amazon.fr
gofundme.com
deezer.com
cornell.edu
pl.wikipedia.org
naver.jp
4shared.com
fastcompany.com
apache.org
cisco.com
metro.co.uk
welt.de
asus.com
disney.com
eventbrite.com
wikihow.com
stanford.edu
rambler.ru
spiegel.de
nydailynews.com
espn.com
nikkei.com
tes.com
doubleclick.net
ja.wikipedia.org
express.co.uk
marriott.com
naver.com
google.co.id
bt.com
princeton.edu
shopify.com
twitch.tv
digg.com
nvidia.com
cambridge.org
mysql.com
mit.edu
t.co
ru.wikipedia.org
sciencedirect.com
ea.com
engadget.com
ikea.com
qq.com
academia.edu
bitly.com
pbs.org
sciencemag.org
soundcloud.com
google.pl
blackberry.com
photobucket.com
smh.com.au
tripadvisor.com
mystrikingly.com
surveymonkey.com
oracle.com
www.over-blog.com
nbcnews.com
yadi.sk
wiley.com
it.wikipedia.org
nationalgeographic.com
wa.me
standard.co.uk
e-recht24.de
mashable.com
berkeley.edu
www.weebly.com
indiatimes.com
iubenda.com
goodreads.com
vox.com
box.com
akamaihd.net
whitehouse.gov
nginx.com
ox.ac.uk
worldbank.org
cbc.ca
spotify.com
gmail.com
huffpost.com
xbox.com
thetimes.co.uk
dell.com
detik.com
zendesk.com
icann.org
utexas.edu
a8.net
rtve.es
amazon.it
theatlantic.com
nature.com
google.ca
washington.edu
channel4.com
cnbc.com
adssettings.google.com
godaddy.com
bp1.blogger.com
bp0.blogger.com
sendspace.com
www.wikipedia.org
fifa.com
theverge.com
sciencedaily.com
about.com
sfgate.com
sputniknews.com
target.com
variety.com
googleblog.com
urbandictionary.com
discovery.com
vchecks.me
businesswire.com
ca.gov
arstechnica.com
allaboutcookies.org
pastebin.com
entrepreneur.com
ucla.edu
tmz.com
skype.com
www.canalblog.com
dreniq.com
softonic.com
asahi.com
autodesk.com
cocolog-nifty.com
thehill.com
sakura.ne.jp
answers.yahoo.com
photos1.blogger.com
nps.gov
home.pl
storage.canalblog.com
coursera.org
vkontakte.ru
people.com
video.google.com
eff.org
about.me
stores.jp
steamcommunity.com
canva.com
adweek.com
nifty.com
e-monsite.com
medicalnewstoday.com
lego.com
home.neustar
etsy.com
answers.com
snapchat.com
oreilly.com
bp3.blogger.com
rediff.com
tabelog.com
mayoclinic.org
calendar.google.com
offset.com
imgur.com
dictionary.com
ameblo.jp
usgs.gov
lonelyplanet.com
interia.pl
nba.com
amazon.ca
theglobeandmail.com
ssl-images-amazon.com
boston.com
weather.com
outlook.com
lycos.com
springer.com
ebay.co.uk
histats.com
foursquare.com
mixcloud.com
slate.com
gutenberg.org
indiegogo.com
venturebeat.com
megaupload.com
afternic.com
ed.gov
ucoz.ru
chron.com
zdnet.com
plos.org
weforum.org
billboard.com
chinadaily.com.cn
ibtimes.com
thestar.com
businessinsider.com.au
huawei.com
history.com
uber.com
google.com.au
dreamstime.com
corriere.it
geocities.jp
inc.com
upenn.edu
thoughtco.com
arxiv.org
si.edu
wattpad.com
clickbank.net
groups.yahoo.com
irs.gov
apnews.com
house.gov
eonline.com
xing.com
axs.com
mhlw.go.jp
ehow.com
chicagotribune.com
thenextweb.com
fda.gov
gesetze-im-internet.de
newscientist.com
khanacademy.org
thedailybeast.com
gamespot.com
amzn.to
ftc.gov"


def self.kosher?(url)
  # url = url.gsub("www.", "")
  unless url.includes?("http")
    url = "https://#{url}"
  end
  uri = URI.parse(url)
  # puts uri.host
  SAFE_DOMAINS.split("\n").select { |domain| domain == uri.host } != [] of String
end

def self.kosher_string!(string)
  regex = /(?:(?:https?|ftp|file):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$])/im
  output_string = string
  i = 0
  while i < string.size
    if matches = output_string.match(regex, i)
      unless kosher?(matches[0])
        output_string = output_string.gsub(matches[0], "[link removed]")
      end
    end
    
    i += 1
  end
  output_string
end


end
